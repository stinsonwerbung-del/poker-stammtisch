<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poker-Stammtisch</title>
  <style>
    :root{
      --bg:#0f1221; --panel:#161a33; --panel2:#1b2040; --text:#e9ecf2; --muted:#aeb6cf;
      --accent:#6ee7ff; --accent2:#8b5cff; --good:#2ecc71; --bad:#e74c3c; --warn:#f1c40f;
      --chip:#232a57; --orange:#7c4e16; --red:#8a2a3b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(135deg,#0b0e1a,#131a34 40%,#0b0e1a);color:var(--text);
         font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid #23274d;background:linear-gradient(180deg,#141939,#121634);}
    h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.2px;}
    .badge{font-size:12px;color:var(--muted)}
    .btn{background:linear-gradient(135deg,var(--accent),#5fb4ff);color:#041224;border:none;padding:9px 12px;border-radius:12px;font-weight:700;box-shadow:0 6px 18px rgba(110,231,255,.15);cursor:pointer}
    .btn.small{ padding:6px 10px; border-radius:10px; font-size:12px }
    .btn.danger{ background:linear-gradient(135deg,#7a2430,#b9313f); color:#fff }
    .btn.secondary{background:linear-gradient(135deg,#2c315d,#3b4375);color:#dfe6ff}
    .btn.ghost{background:transparent;border:1px solid #3a406f;color:#cdd5ff}
    .container{max-width:1100px;margin:16px auto;padding:0 12px;}
    .status{margin:10px 0;padding:8px 10px;border-radius:12px;background:var(--panel);display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;font-size:12px;background:#23274d;color:var(--muted)}
    .pill.good{background:#1e2b3d;color:#9ee8b5}
    .pill.warn{background:#3a3422;color:#f8e08c}
    .pill.bad{background:#3b2330;color:#ffb2b2}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #222752;padding:12px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 4px 0;font-size:16px}
    .sub{font-size:12px;color:var(--muted);}
    .rankRow{display:flex;align-items:center;justify-content:space-between;margin-top:6px}
    .bar{height:10px;background:var(--chip);border-radius:999px;overflow:hidden;margin-top:8px;}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,#6ee7ff,#8b5cff);width:0%;transition:width .4s ease}
    .avatar{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid #2b2f63;background:#1a1f44;display:inline-block}
    .avatar.big{width:64px;height:64px;border-width:2px}
    .avatar.mid{width:36px;height:36px}
    .avatar.mini{width:20px;height:20px}
    .avatarWrap{ position:relative; display:inline-block }
    .streakBadge{
      position:absolute; right:-4px; bottom:-4px;
      background:#ff7a00; color:#fff; border-radius:999px;
      font-size:10px; padding:1px 5px; border:2px solid #1a1f44;
      display:flex; align-items:center; gap:2px; line-height:1
    }
    .streakBadge b{ font-weight:800 }
    .tbl{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:12px}
    .row{background:linear-gradient(180deg,var(--panel2),#141939);border:1px solid #222752;border-radius:12px;overflow:hidden}
    .row.incomplete{background:linear-gradient(180deg,#2a2230,#2b2117);border-color:var(--orange)}
    .row.overshoot{background:linear-gradient(180deg,#2a1b24,#2b1420);border-color:var(--red)}
    .row td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.03)}
    .row tr:last-child td{border-bottom:none}
    .footerFlex{display:flex;align-items:center;justify-content:space-between;gap:6px;flex-wrap:wrap}
    #roundsTableWrap{overflow-x:auto}
    dialog{border:none;border-radius:16px;padding:0;background:linear-gradient(180deg,#111633,#0f1430);color:var(--text);box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .modal{padding:14px;border:1px solid #222752;border-radius:16px}
    .modal h2{margin:0 0 8px 0;font-size:18px}
    .form{display:grid;gap:10px}
    .form label{font-size:12px;color:var(--muted)}
    .form input[type="date"], .form input[type="number"], .form input[type="password"], .form input[type="text"], .form input[type="file"], .form select{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #293062;background:#0e1230;color:var(--text)}
    .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .hidden{display:none}
    .ok{color:var(--good)}
    .bad{color:var(--bad)}
    footer{margin:30px 0 20px; text-align:center; color:var(--muted);}
    @media print {
      header, .btn, .status, #btnLogout, footer { display:none !important; }
      body { background:#fff; color:#000; }
      .card { box-shadow:none; border:1px solid #ccc; background:#fff; }
      .container { max-width:100%; margin:0; padding:0 8px; }
      .tbl { border-spacing:0; }
      .row { background:#fff; border-color:#ccc; }
    }
    [data-loading="1"] { cursor: progress; }
  </style>
</head>
<body>
  <header>
    <div><h1>Poker-Stammtisch</h1></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <button class="btn secondary" id="openBtn">📂 Öffnen</button>
      <button class="btn secondary" id="saveBtn">💾 Speichern</button>
    </div>
  </header>

  <div class="container">
    <!-- AUTH LANDING -->
    <section id="view_auth">
      <div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin:30px 0">
        <div style="text-align:center">
          <button class="btn ghost" id="btnLoginProfile"
                  style="width:120px;height:120px;border-radius:60px;display:grid;place-items:center;font-size:28px">👥</button>
          <div class="sub" style="margin-top:6px">Profil wählen</div>
          <div style="margin-top:10px">
            <a href="#" id="linkRegister" class="sub" style="text-decoration:underline">Registrieren</a>
          </div>
        </div>
      </div>
      <div id="authList" class="grid" style="display:none"></div>
    </section>

    <!-- HOME -->
    <section id="view_home" class="hidden">
      <div class="status">
        <span class="pill" id="whoPill">Eingeloggt als: —</span>
        <button class="btn small ghost" id="btnEditSelf">Profil bearbeiten</button>
        <button class="btn small ghost" id="btnStreakSettings">🔥 Streak-Einstellungen</button>
        <button class="btn small ghost" id="btnLogout">Abmelden</button>
      </div>
      <div class="grid">
        <div class="card">
          <h3>➕ Turnier erstellen</h3>
          <div class="sub">Du wirst automatisch Turnier-Admin</div>
          <div style="margin-top:8px"><button class="btn" id="btnNewTournament">Neues Turnier</button></div>
        </div>
        <div class="card" style="grid-column: span 3">
          <h3>🏆 Deine Turniere</h3>
          <div class="sub">Turniere, in denen dein Profil spielt</div>
          <div id="myTournamentList" style="margin-top:8px"></div>
          <div style="margin-top:14px"></div>
          <h3 style="margin-top:10px">👀 Laufende Turniere (ohne Teilnahme)</h3>
          <div class="sub">Zum Anschauen oder Beitritt anfragen</div>
          <div id="otherTournamentList" style="margin-top:8px"></div>
        </div>
      </div>
    </section>

    <!-- TURNIER -->
    <section id="view_tournament" class="hidden">
      <div class="status" id="tourStatus">
        <span class="pill" id="scopePill">Ansicht: Turnier</span>
        <span class="pill" id="sumState">Letzte Runde: —</span>
        <span class="pill">Trend: ↑ besser · ↓ schlechter · → gleich</span>
        <span class="pill warn" id="flagIncomplete" style="display:none">Unvollständige Zählung</span>
        <span class="pill bad" id="flagOvershoot" style="display:none">Überschüssige Zählung</span>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
          <div>
            <h3 id="dashTitle" style="margin:0"></h3>
            <div class="sub" id="dashSub"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn secondary" id="btnBackHome">← Übersicht</button>
            <button class="btn" id="addRoundBtn">➕ Neue Runde</button>
            <button class="btn ghost" id="btnTourSettings">⚙️ Einstellungen</button>
          </div>
        </div>
      </div>

      <section style="margin-top:10px">
        <h2 style="font-size:18px;margin:8px 0 10px">Gesamt-Leaderboard</h2>
        <div class="grid" id="leaderGrid"></div>
      </section>

      <section>
        <h2 style="font-size:18px;margin:12px 0 8px">Runden</h2>
        <div id="roundsTableWrap">
          <table class="tbl" id="roundsTable">
            <thead>
              <tr>
                <th style="min-width:120px">Datum</th>
                <th style="min-width:150px">Rang (Runde)</th>
                <th>Spieler</th>
                <th style="min-width:260px">Werte</th>
              </tr>
            </thead>
            <tbody id="roundsBody"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- PROFIL / QUICK-VIEW -->
    <section id="view_profile" class="hidden">
      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap">
          <div>
            <h3 id="profTitle" style="margin:0"></h3>
            <div class="sub" id="profSub"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <select id="profScopeSel">
              <option value="all">Gesamt (alle Turniere)</option>
            </select>
            <button class="btn" id="profPrint">🖨️ Drucken</button>
            <button class="btn secondary" id="profBack">← Zurück</button>
          </div>
        </div>
      </div>

      <div class="grid" id="profKpis" style="margin-top:10px"></div>

      <div class="card" style="margin-top:10px">
        <div class="bar" style="height:40px"><div id="pv_spark" style="display:flex;height:100%;gap:3px"></div></div>
        <div class="sub" style="margin-top:6px">%Stack Verlauf (chronologisch)</div>
      </div>

      <div class="card" style="margin-top:10px">
        <table class="tbl" style="margin-top:0">
          <thead><tr>
            <th style="width:120px">Datum</th>
            <th style="width:160px">Turnier</th>
            <th style="width:90px">Rang</th>
            <th style="width:90px">Chips</th>
            <th style="width:90px">%Stack</th>
            <th style="width:120px">Status</th>
          </tr></thead>
          <tbody id="profRows"></tbody>
        </table>
      </div>
    </section>
  </div>

  <footer>© Brenner</footer>

  <!-- DIALOGE -->
  <dialog id="dlgTournament">
    <div class="modal">
      <h2>Turnier erstellen</h2>
      <div class="form">
        <label>Name <input type="text" id="tourName" placeholder="z. B. Herbst 2025" /></label>
        <label>Startdatum <input type="date" id="tourDate" /></label>
        <div class="grid2">
          <label>Start-Chips pro Person <input type="number" id="tourStartChips" value="640" min="1" step="1" /></label>
          <label>Spielerzahl (für Soll-Summe) <input type="number" id="tourPlayerCount" value="4" min="2" step="1" /></label>
        </div>
        <div>
          <label>Spieler (Profile auswählen)</label>
          <div id="tourPlayers" class="grid2"></div>
        </div>
        <div class="sub">Hinweis: Du wirst automatisch Turnier-Admin. Weitere Admins kannst du später festlegen.</div>
      </div>
      <div class="modalFooter">
        <button class="btn secondary" id="tourCancel">Abbrechen</button>
        <button class="btn" id="tourCreate">Erstellen</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgRound">
    <div class="modal">
      <h2 id="dlgRoundTitle">Neue Runde</h2>
      <div id="roundForm" class="form"></div>
      <div class="grid3">
        <button class="btn ghost" id="btnFillRest">↗️ Rest auffüllen</button>
        <div id="sumHint" class="sub" style="align-self:center">Summe: 0</div>
        <div></div>
      </div>
      <div class="modalFooter">
        <button class="btn secondary" id="roundCancel">Abbrechen</button>
        <button class="btn" id="roundSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgComment">
    <div class="modal">
      <h2>Runden-Kommentar</h2>
      <div class="form"><label>Kommentar <input type="text" id="commentText" placeholder="kurze Notiz…" /></label></div>
      <div class="modalFooter">
        <button class="btn secondary" id="commentCancel">Abbrechen</button>
        <button class="btn" id="commentSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgProfileEdit">
    <div class="modal">
      <h2 id="dlgProfileTitle">Profil</h2>
      <div class="form">
        <label>Name <input type="text" id="profName" /></label>
        <div id="profPwBlock">
          <label id="lblProfPwCurrent" style="display:none">Aktuelles Passwort
            <input type="password" id="profPwCurrent" placeholder="zur Bestätigung" />
          </label>
          <label>Neues Passwort (optional) <input type="password" id="profPwNew1" placeholder="mind. 4 Zeichen" /></label>
          <label>Neues Passwort wiederholen <input type="password" id="profPwNew2" /></label>
        </div>
        <label>Avatar <input type="file" id="profAvatar" accept="image/*" /></label>
        <div id="profAvatarPreview"></div>
      </div>
      <div class="modalFooter">
        <button class="btn secondary" id="profCancel">Abbrechen</button>
        <button class="btn" id="profSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgTourSettings">
    <div class="modal">
      <h2>Turnier-Einstellungen</h2>
      <div class="form">
        <div class="grid2">
          <label>Start-Chips pro Person <input type="number" id="setStartChips" min="1" step="1" /></label>
          <label>Soll-Spielerzahl <input type="number" id="setPlayerCount" min="2" step="1" /></label>
        </div>
        <label>Admins (Profile anhaken)</label>
        <div id="setAdmins" class="grid2"></div>
      </div>
      <div class="modalFooter">
        <button class="btn secondary" id="setCancel">Abbrechen</button>
        <button class="btn" id="setSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgStreakSettings">
    <div class="modal">
      <h2>Streak-Einstellungen (global)</h2>
      <div class="form">
        <div class="sub">Angehakte Wochentage werden <b>pausiert</b> (zählen nicht, brechen nicht).</div>
        <div class="grid3" id="weekPauseGrid"></div>
      </div>
      <div class="modalFooter">
        <button class="btn secondary" id="streakCancel">Abbrechen</button>
        <button class="btn" id="streakSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
