<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poker-Stammtisch</title>
  <style>
    :root{
      --bg:#0f1221; --panel:#161a33; --panel2:#1b2040; --text:#e9ecf2; --muted:#aeb6cf;
      --accent:#6ee7ff; --accent2:#8b5cff; --good:#2ecc71; --bad:#e74c3c; --warn:#f1c40f;
      --chip:#232a57; --orange:#7c4e16; --red:#8a2a3b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(135deg,#0b0e1a,#131a34 40%,#0b0e1a);color:var(--text);
         font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid #23274d;background:linear-gradient(180deg,#141939,#121634);}
    h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.2px;}
    .btn{background:linear-gradient(135deg,var(--accent),#5fb4ff);color:#041224;border:none;padding:9px 12px;border-radius:12px;font-weight:700;box-shadow:0 6px 18px rgba(110,231,255,.15);cursor:pointer}
    .btn.small{ padding:6px 10px; border-radius:10px; font-size:12px }
    .btn.danger{ background:linear-gradient(135deg,#7a2430,#b9313f); color:#fff }
    .btn.secondary{background:linear-gradient(135deg,#2c315d,#3b4375);color:#dfe6ff}
    .btn.ghost{background:transparent;border:1px solid #3a406f;color:#cdd5ff}
    .container{max-width:1100px;margin:16px auto;padding:0 12px;}
    .status{margin:10px 0;padding:8px 10px;border-radius:12px;background:var(--panel);display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;font-size:12px;background:#23274d;color:var(--muted)}
    .pill.good{background:#1e2b3d;color:#9ee8b5}
    .pill.warn{background:#3a3422;color:#f8e08c}
    .pill.bad{background:#3b2330;color:#ffb2b2}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #222752;padding:12px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 4px 0;font-size:16px}
    .sub{font-size:12px;color:var(--muted);}

    .bar{height:10px;background:var(--chip);border-radius:999px;overflow:hidden;margin-top:8px;}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,#6ee7ff,#8b5cff);width:0%;transition:width .4s ease}
    .bar.gray>span{ background:linear-gradient(90deg,#d6d6d6,#888); }

    .avatar{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid #2b2f63;background:#1a1f44;display:inline-block}
    .avatar.big{width:64px;height:64px;border-width:2px}
    .avatar.mid{width:36px;height:36px}
    .avatar.mini{width:20px;height:20px}
    .avatarWrap{ position:relative; display:inline-block }

    /* Round-Card (breites blaues Feld) */
    .roundCard{
      border:1px solid #222752; border-radius:14px; background:linear-gradient(180deg,var(--panel2),#141939);
      padding:10px; margin-bottom:10px;
    }
    .roundHead{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    .roundHead .date{font-weight:700}
    .roundHead .meta{font-size:12px;color:var(--muted)}
    .roundRow{display:grid;grid-template-columns:120px 1fr 1fr;gap:8px;padding:6px 8px;border-radius:10px;background:rgba(255,255,255,.03);margin:4px 0}
    .roundFoot{display:flex;align-items:center;gap:8px;justify-content:space-between;flex-wrap:wrap;margin-top:6px}
    .sumOK{color:#9ee8b5}.sumBad{color:#ffb2b2}.sumWarn{color:#f8e08c}

    /* Dialoge */
    dialog{border:none;border-radius:16px;padding:0;background:linear-gradient(180deg,#111633,#0f1430);color:var(--text);box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .modal{padding:14px;border:1px solid #222752;border-radius:16px}
    .modal h2{margin:0 0 8px 0;font-size:18px}
    .form{display:grid;gap:10px}
    .form label{font-size:12px;color:var(--muted)}

    /* Einheitlich blaue Inputs/Selects */
    input[type="date"], input[type="number"], input[type="password"], input[type="text"], input[type="file"], select{
      width:100%;padding:8px 10px;border-radius:10px;border:1px solid #293062;
      background:#0e1230;color:var(--text);font-size:16px;-webkit-appearance:none;appearance:none;
    }

    .scroll-x{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .tbl thead th{ white-space:nowrap; }

    /* Header-Avatar-Button */
    .header-avatar-btn{
      width:40px; height:40px; border-radius:50%;
      padding:0; background:transparent; border:1px solid #3a406f; cursor:pointer;
      display:grid; place-items:center; position:relative;
    }
    .header-avatar-btn img{ width:36px; height:36px; border-radius:50%; object-fit:cover; display:block; }

    /* Streak-Badge */
    .streakBadge{
      position:absolute; right:-6px; bottom:-6px;
      background:#ff9f43; color:#1b1020; border:2px solid #0e1230;
      font-weight:800; font-size:11px; line-height:1; padding:3px 6px; border-radius:999px;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
    }
    .streakBadge::before{ content:"🔥 "; }

    /* KPIs untereinander im Profil */
    .kpiGrid{display:grid;gap:4px}
    .kpiGrid .row{display:flex;gap:8px;flex-wrap:wrap}

    footer{margin:20px 0;text-align:center;font-size:12px;color:var(--muted);}
    .hidden{display:none}

    @media print {
      header, .btn, .status, #btnLogout { display:none !important; }
      body { background:#fff; color:#000; }
      .card { box-shadow:none; border:1px solid #ccc; background:#fff; }
      .container { max-width:100%; margin:0; padding:0 8px; }
      .roundCard { background:#fff; border-color:#ccc }
    }
#pv_spark { display:flex; align-items:flex-end; gap:3px; height:40px; }
#pv_spark > span{
  flex:1 0 6px;
  background:linear-gradient(180deg,#6ee7ff,#8b5cff);
  border-radius:2px;
  min-height:3px;
  
}
.al-right { text-align: right; }
.al-left  { text-align: left;  }



@media print {
  /* Wenn wir All-Time drucken, blenden wir die normale UI aus,
     und zeigen NUR den Print-Container. */
  body.printing-at header,
  body.printing-at .container,
  body.printing-at dialog { display:none !important; }

  body.printing-at #printAllTime { 
    display:block !important; 
    color:#000; 
    background:#fff;
    padding:12px;
  }

  /* saubere Tabellenlinien */
  body.printing-at #printAllTime table td,
  body.printing-at #printAllTime table th { 
    border-bottom:1px solid #e0e0e0;
  }

  /* Farben im Druck erlauben (falls gebraucht) */
  * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
}
#printAllTime { display: none; }


  </style>
</head>
<body>
  <header>
    <div><h1>Poker-Stammtisch</h1></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <!-- Header-Profil – NUR nach Login -->
      <button id="btnHeaderProfile" title="Profil & Quick-View" class="header-avatar-btn hidden">
        <img id="headerAvatar" alt="Profil" />
      </button>
    </div>
  </header>

  <div class="container">
    <!-- AUTH -->
    <section id="view_auth">
      <div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin:30px 0">
        <div style="text-align:center">
          <button class="btn ghost" id="btnLoginProfile"
                  style="width:120px;height:120px;border-radius:60px;display:grid;place-items:center;font-size:28px">👥</button>
          <div class="sub" style="margin-top:6px">Profil wählen</div>
          <div style="margin-top:10px"><a href="#" id="linkRegister" class="sub" style="text-decoration:underline">Registrieren</a></div>
          <div style="margin-top:6px"><a href="#" id="linkOtherProfile" class="sub" style="text-decoration:underline">Anderes Profil wählen</a></div>
        </div>
      </div>
      <div id="authList" class="grid" style="display:none"></div>
    </section>

    <!-- HOME -->
    <section id="view_home" class="hidden">
      <div class="status">
        <span class="pill" id="whoPill">Eingeloggt als: —</span>
        <button class="btn small ghost" id="btnLogout">Abmelden</button>
      </div>
      <div class="grid">
        <div class="card">
          <h3>➕ Turnier erstellen</h3>
          <div class="sub">Du wirst automatisch Turnier-Admin</div>
          <div style="margin-top:8px"><button class="btn" id="btnNewTournament">Neues Turnier</button></div>
        </div>
        <div class="card" style="grid-column: span 3">
          <h3>🏆 Deine Turniere</h3>
          <div id="myTournamentList" style="margin-top:8px"></div>
          <h3 style="margin-top:16px">👀 Laufende Turniere</h3>
          <div id="otherTournamentList" style="margin-top:8px"></div>
        </div>
      </div>
      <div style="margin-top:20px"><button class="btn secondary" id="btnAllTime">📈 All-Time Bester</button></div>
    </section>

    <!-- TURNIER -->
    <section id="view_tournament" class="hidden">
      <div class="status">
        <span class="pill" id="scopePill">Ansicht: Turnier</span>
        <span class="pill" id="sumState">Letzte Runde: —</span>
        <span class="pill warn hidden" id="flagIncomplete">Unvollständig</span>
        <span class="pill bad hidden" id="flagOvershoot">Überschüssig</span>
      </div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
          <div>
            <h3 id="dashTitle" style="margin:0"></h3>
            <div class="sub" id="dashSub"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn secondary" id="btnBackHome">← Übersicht</button>
            <button class="btn" id="addRoundBtn">➕ Neue Runde</button>
            <button class="btn ghost" id="btnTourSettings">⚙️ Einstellungen</button>
          </div>
        </div>
      </div>

      <section style="margin-top:10px">
        <h2 style="font-size:18px;margin:8px 0 10px">Gesamt-Leaderboard</h2>
        <div class="grid" id="leaderGrid"></div>
      </section>

      <section>
        <h2 style="font-size:18px;margin:12px 0 8px">Runden</h2>
        <div id="roundsList"></div> <!-- große blaue Karten -->
      </section>
    </section>

    <!-- PROFIL -->
    <section id="view_profile" class="hidden">
      <div class="card">
        <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap">
          <div>
            <h3 id="profTitle"></h3>
            <!-- KPIs hier in mehreren Zeilen -->
            <div id="profMeta" class="kpiGrid"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <select id="profScopeSel"><option value="all">Gesamt (alle Turniere)</option></select>
            <button class="btn" id="profPrint">🖨️ Drucken</button>
            <button class="btn ghost" id="profEdit">⚙️ Profil</button> <!-- nur hier sichtbar -->
            <button class="btn secondary" id="profBack">← Zurück</button>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top:10px">
        <div class="bar gray" style="height:40px"><div id="pv_spark" style="display:flex;height:100%;gap:3px"></div></div>
        <div class="sub">%Stack Verlauf</div>
      </div>
      <div class="card" style="margin-top:10px">
        <div id="profTableWrap" class="scroll-x">
          <table class="tbl" style="margin-top:0; min-width:700px">
            <thead><tr>
              <th>Datum</th><th>Turnier</th><th>Rang</th><th>Chips</th><th>%Stack</th><th>Status</th>
            </tr></thead>
            <tbody id="profRows"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <!-- All-Time Ergebnis -->
  <dialog id="dlgAllTimeResult">
    <div class="modal" id="at_result_card">
      <h2>All-Time – Ergebnis</h2>
      <div class="sub" id="at_header">Sortiert nach …</div>
      <div class="card" style="margin-top:10px">
        <div id="at_tableWrap" class="scroll-x">
          <table class="tbl at" style="margin-top:0; width:100%; min-width:760px">
            <thead>
              <tr>
                <th>Spieler</th>
                <th class="al-right">Spiele</th>
                <th class="al-right">Ø Chips</th>
                <th class="al-right">Ø %Stack</th>
                <th class="al-right">€ Bilanz</th>
                <th class="al-right">⏱ Spielzeit</th>
              </tr>
            </thead>
            <tbody id="at_rows"></tbody>
          </table>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="atResPrint">🖨️ Drucken</button>
        <button class="btn ghost" id="atResClose">Schließen</button>
      </div>
    </div>
  </dialog>

  <footer>© Brenner</footer>

  <!-- ====== DIALOGE ====== -->
  <dialog id="dlgTournament">
    <div class="modal">
      <h2>Turnier erstellen</h2>
      <div class="form">
        <label>Name <input type="text" id="tourName" placeholder="z. B. Herbst 2025" /></label>
        <label>Startdatum <input type="date" id="tourDate" /></label>
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px">
          <label>Start-Chips pro Person <input type="number" id="tourStartChips" value="640" min="1" step="1" /></label>
          <label>Soll-Spielerzahl <input type="number" id="tourPlayerCount" value="4" min="2" step="1" /></label>
        </div>
        <div>
          <label>Spieler (Profile auswählen)</label>
          <div id="tourPlayers" class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px"></div>
        </div>
        <div class="sub">Hinweis: Du wirst automatisch Turnier-Admin. Weitere Admins kannst du später festlegen.</div>
      </div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="tourCancel">Abbrechen</button>
        <button class="btn" id="tourCreate">Erstellen</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgRound">
    <div class="modal">
      <h2 id="dlgRoundTitle">Neue Runde</h2>
      <div id="roundForm" class="form"></div>
      <div id="sumHint" class="sub" style="margin-top:4px">Summe: 0</div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="roundCancel">Abbrechen</button>
        <button class="btn" id="roundSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgComment">
    <div class="modal">
      <h2>Runden-Kommentar</h2>
      <div class="form">
        <label>Kommentar <input type="text" id="commentText" placeholder="kurze Notiz…" /></label>
      </div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="commentCancel">Abbrechen</button>
        <button class="btn" id="commentSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgProfileEdit">
    <div class="modal">
      <h2 id="dlgProfileTitle">Profil</h2>
      <div class="form">
        <label>Name <input type="text" id="profName" /></label>
        <div id="profPwBlock">
          <label id="lblProfPwCurrent" style="display:none">Aktuelles Passwort
            <input type="password" id="profPwCurrent" placeholder="zur Bestätigung" />
          </label>
          <label>Neues Passwort (optional) <input type="password" id="profPwNew1" placeholder="mind. 4 Zeichen" /></label>
          <label>Neues Passwort wiederholen <input type="password" id="profPwNew2" /></label>
        </div>

        <!-- Streak-Einstellungen -->
        <div id="streakPrefs" class="sub" style="margin-top:6px">
          <div>Streak wertet an diesen Tagen (Mo–So):</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
            <label><input type="checkbox" data-dow="1"> Mo</label>
            <label><input type="checkbox" data-dow="2"> Di</label>
            <label><input type="checkbox" data-dow="3"> Mi</label>
            <label><input type="checkbox" data-dow="4"> Do</label>
            <label><input type="checkbox" data-dow="5"> Fr</label>
            <label><input type="checkbox" data-dow="6"> Sa</label>
            <label><input type="checkbox" data-dow="0"> So</label>
          </div>
        </div>

        <label>Avatar <input type="file" id="profAvatar" accept="image/*" /></label>
        <div id="profAvatarPreview"></div>
      </div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="profCancel">Abbrechen</button>
        <button class="btn" id="profSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgTourSettings">
    <div class="modal">
      <h2>Turnier-Einstellungen</h2>
      <div class="form">
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px">
          <label>Start-Chips pro Person <input type="number" id="setStartChips" min="1" step="1" /></label>
          <label>Soll-Spielerzahl <input type="number" id="setPlayerCount" min="2" step="1" /></label>
        </div>
        <label>Admins (nur Teilnehmer)</label>
        <div id="setAdmins" class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px"></div>
      </div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="setCancel">Abbrechen</button>
        <button class="btn" id="setSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgAllTime">
    <div class="modal">
      <h2>All-Time – Auswahl</h2>
      <div class="form">
        <label>Spieler (ankreuzen)</label>
        <div id="at_players" class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px"></div>
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px">
          <label>Sortierung
            <select id="at_sort">
              <option value="avgStack">Ø %Stack</option>
              <option value="avgChips">Ø Chips</option>
              <option value="euroBalance">€ Bilanz</option>
              <option value="games">Spiele</option>
            </select>
          </label>
          <label>Reihenfolge
            <select id="at_dir">
              <option value="desc">Absteigend</option>
              <option value="asc">Aufsteigend</option>
            </select>
          </label>
        </div>
      </div>
      <div class="modalFooter" style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn secondary" id="atCancel">Abbrechen</button>
        <button class="btn" id="atApply">Anzeigen</button>
      </div>
    </div>
  </dialog>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBDl3rpU3GjTb_c9rzzHQ04FCMAsBPVbYg",
      authDomain: "poker-2c3c6.firebaseapp.com",
      databaseURL: "https://poker-2c3c6-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "poker-2c3c6",
      storageBucket: "poker-2c3c6.appspot.com",
      messagingSenderId: "328907378433",
      appId: "1:328907378433:web:876270513cbe1636895500"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- App -->
  <script src="app.js"></script>
  
  <!-- PRINT-ONLY: All-Time Ergebnis -->
<div id="printAllTime" class="print-only" aria-hidden="true">
  <h2 style="margin:0 0 6px">All-Time – Ergebnis</h2>
  <div id="printAtMeta" class="sub" style="margin-bottom:8px"></div>

  <table style="width:100%;border-collapse:collapse;font-size:14px">
    <thead>
      <tr>
        <th style="text-align:left;border-bottom:1px solid #ccc;padding:6px">Spieler</th>
        <th style="text-align:right;border-bottom:1px solid #ccc;padding:6px">Spiele</th>
        <th style="text-align:right;border-bottom:1px solid #ccc;padding:6px">Ø Chips</th>
        <th style="text-align:right;border-bottom:1px solid #ccc;padding:6px">Ø %Stack</th>
        <th style="text-align:right;border-bottom:1px solid #ccc;padding:6px">€ Bilanz</th>
        <th style="text-align:right;border-bottom:1px solid #ccc;padding:6px">⏱ Spielzeit</th>
      </tr>
    </thead>
    <tbody id="printAtRows"></tbody>
  </table>

  <div class="sub" id="printAtFooter" style="margin-top:8px"></div>
</div>

</body>
</html>
